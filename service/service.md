# 서비스
## 서비스 타입
- ClusterIP
  - 기본 서비스 타입
  - 쿠버네티스 클러스터 안에서만 사용 가능
  - 클러스터 안 노드나 파드에서는 클러스터 IP를 이용해서 서비스에 연결된 파드에 접근
```
-----------------------------------------
| k8s cluster                           |
|                                       |
|  pod  ->  service                     |
|            /   \                      |
|          p1    p2                     |
|   (10.1.1.196)  (10.1.1.197)          |
-----------------------------------------
유저는 직접 접근 불가, 파드끼리 통신
```
- NodePort
  - **서비스 하나에 모든 노드의 지정된 포트 할당**
  - 노드의 포트를 사용하므로 클러스터 안 뿐만 아니라 외부에서도 접근 가능
```
             User
             |
     ------------------------
-----|      service         |------------
|    |  (NodePort: 30080)   |           |
|    ------------------------           |
|            /   \                      |
|          p1    p2                     |
|   (10.1.1.196)  (10.1.1.197)          |
-----------------------------------------
```
- LoadBalancer
  - 로드밸런서와 파드를 연결한 후 로드밸런서의 IP를 이용해 클러스터 외부에서 파드에 접근
  - public cloud service(AWS, GCP), private cloud service(OpenStack) 등 쿠버네티스를 지원하는 로드밸런서 장비에서 사용
```
              User
               | 
     ------------------------
     |      service         |
     | (LoadBalancer: 장비)  |           
     ------------------------           
               |
-----------------------------------------
|            /   \                      |
|          p1    p2                     |
|   (10.1.1.196)  (10.1.1.197)          |
-----------------------------------------
```
- ExternalName
  - 서비스를 .spec.externalName 필드에 설정한 값과 연결
  - **클러스터 안에서 외부에 접근**할 때 주로 사용
    - 클러스터 외부에 접근할 때 사용하는 값이므로 셀렉터가 필요 없다.

```
-----------------
| k8s cluster   |
|            3  |
|   pod   ------|---> google.com
|  1 | | 2      |
|    | |        |
| service       |     
|(ExternalName) |
-----------------
1. DNS 요청
2. CNAME 값 반환(google.com)
3. 접속
```
- Headless
  - .spec.clusterIP값을 `None`으로 설정하면 클러스터 IP가 없는 서비스를 만들 수 있다.
  - 로드밸런싱이 필요 없거나 단일 서비스 IP가 필요 없을 때 사용
  - 셀렉터를 설정하면 엔드포인트와 DNS A 레코드가 만들어진다. (없다면 만들어지지 않는다.)
    - 단, 셀렉터가 없더라도 CNAME 레코드는 만들어진다.
## 서비스 기본 설정
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  # 서비스 타입 지정, 기본 타입은 ClusterIP
  type: ClusterIP
  clusterIP: 10.0.10.10
  # 서비스와 연결할 파드에 설정한 .labels 필드 값
  selector:
    app: MyApp
  # 서비스에서 한꺼번에 포트 여러 개를 외부에 제공할 때는 ports[] 하위에 설정
  ports:
  - protocol: TCP
    port: 80
    targetPort: 9376
```