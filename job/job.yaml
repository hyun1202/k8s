apiVersion: batch/v1
kind: Job
metadata:
  name: pi
spec:
  template:
    spec:
      containers:
      - name: pi
        image: perl
        # 원주율 계산
        command: ["perl", "-Mbignum=bpi", "-wle", "print bpi(2000)"]
      # 재시작 정책
      # Never: 파드가 항상 성공으로 끝남
      # OnFailure: 파드 안 컨테이너가 비정상 종료 시 컨테이너 재시작
      restartPolicy: Never
  # 잡 실행이 실패했을 때 최대 재시작 횟수 설정
  # backoff로 점차 재시작 대기 시간을 늘림
  # 파드 실행이 완료되면 재시도 횟수는 0으로 초기화
  backoffLimit: 4
  # 잡 하나가 파드를 동시에 몇 개 실행할 지 설정
  # 기본 값은 1, 0으로 설정하면 잡 정지
  # 정상 완료되는 잡의 개수를 고정하기 위해선 실행 되는 실제 파드 개수 < 남아 있는 잡의 개수
  # 워크 큐용 잡에서는 파드 하나가 정상적으로 완료되면 새로운 파드가 실행되지 않음
  # 잡 컨트롤러가 자원 부족이나 권한 부족같은 이유로 파드를 실행하지 못할 수 있음
  # 잡에서 실행시킨 파드들이 너무 많이 실패하면 컨트롤러가 새로운 파드 생성을 제한할 수 있음
  # 파드가 그레이스풀하게 종료되었을 수도 있음
  parallelism: 1