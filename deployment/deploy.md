# 쿠버네티스 배포 방법

## 롤링 업데이트
- 배포된 전체 파드를 일정 개수씩 교체하면서 배포한다.
- **디플로이먼트의 기본 배포 방법**

## 블루/그린
- 기존에 실행된 파드 개수와 같은 개수의 신규 파드를 모두 실행한 후 트래픽을 한꺼번에 신규 파드로 옮긴다.

## 카나리
- 신규 파드를 배포할 때 한꺼번에 전체를 교체하지 않고 **기존 버전을 유지한 채로 일부 버전만 신규 파드로 교체**한다.
- 버그나 이상이 없는지, 사용자 반응은 어떤지 확인할 때 유용하다.

> 쿠버네티스의 기본 디플로이먼트는 모두 교체하는 방식이므로 카나리 방법으로 배포하기에는 어려움이 있다.
하지만, 레이블을 이용해서 카나리 방법으로 배포가 가능하다.

### 레이블을 이용한 카나리 배포
- 레이블과 replicas를 지정하여 기존 버전과 카나리 버전을 생성한다.
  - 더 많은 사용자에게 카나리 방법의 배포를 테스트하고 싶으면 replicas 값을 1보다 높은 숫자로 변경
- 해당 레이블로 파드와 서비스를 연결한다.
- 카나리가 정상적으로 작동하면 stable 버전의 컨테이너 이미지를 업데이트